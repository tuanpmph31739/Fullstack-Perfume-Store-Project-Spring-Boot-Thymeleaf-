<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/admin/fragments/head :: head}"></head>
<body>
<div class="wrapper">

    <aside th:replace="~{/admin/fragments/sidebar :: sidebar}"></aside>

    <div id="main">

        <header th:replace="~{/admin/fragments/header :: header}"></header>

        <div class="page-heading">
            <div class="page-title">
                <div class="row">
                    <div class="col-12 col-md-6 order-md-1 order-last">
                        <h3>Quản lý Sản phẩm chi tiết</h3>
                    </div>
                    <div class="col-12 col-md-6 order-md-2 order-first text-end">
                        <a th:href="@{/admin/san-pham-chi-tiet/add}" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Thêm sản phẩm chi tiết
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="page-content">
            <section class="row">
                <div class="card table-card">

                    <div class="card-header">
                        <h5 class="mb-0">Danh sách sản phẩm chi tiết</h5>
                    </div>

                    <div class="card-body">

                        <!-- FORM LỌC -->
                        <form th:action="@{/admin/san-pham-chi-tiet}" method="get">

                            <div class="table-responsive">
                                <table class="table table-striped table-fixed align-middle">
                                    <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Ảnh</th>
                                        <th>Tên sản phẩm</th>
                                        <th>SKU</th>
                                        <th>Giá</th>
                                        <th>ML</th>
                                        <th>Nồng độ</th>
                                        <th>Tồn</th>
                                        <th>Trạng thái</th>
                                        <th>Hành động</th>
                                    </tr>

                                    <!-- Lọc -->
                                    <tr>
                                        <th></th>
                                        <th></th>

                                        <th>
                                            <input type="text" name="keyword"
                                                   class="form-control form-control-sm"
                                                   placeholder="Tên SP..."
                                                   th:value="${keyword}">

                                        </th>

                                        <th>
                                            <input type="text" name="sku"
                                                   class="form-control form-control-sm"
                                                   placeholder="SKU..."
                                                   th:value="${sku}">

                                        </th>

                                        <th>
                                            <div class="d-flex gap-1">

                                                <!-- Hiển thị cho người dùng (có chấm) -->
                                                <input type="text"
                                                       id="giaMinDisplay"
                                                       class="form-control form-control-sm"
                                                       placeholder="Từ"
                                                       th:value="${giaMin != null ? #numbers.formatInteger(giaMin, 0, 'POINT') : ''}">

                                                <input type="text"
                                                       id="giaMaxDisplay"
                                                       class="form-control form-control-sm"
                                                       placeholder="Đến"
                                                       th:value="${giaMax != null ? #numbers.formatInteger(giaMax, 0, 'POINT') : ''}">

                                                <!-- Giá trị thật gửi lên server -->
                                                <input type="hidden" name="giaMin" id="giaMin" th:value="${giaMin}">
                                                <input type="hidden" name="giaMax" id="giaMax" th:value="${giaMax}">
                                            </div>
                                        </th>


                                        <th>
                                            <select name="dungTichId" class="form-select form-select-sm">
                                                <option value="">Tất cả</option>
                                                <option th:each="dt : ${listDungTich}"
                                                        th:value="${dt.id}"
                                                        th:text="${dt.soMl}"
                                                        th:selected="${dungTichId != null and dungTichId == dt.id}">
                                                </option>
                                            </select>
                                        </th>

                                        <th>
                                            <select name="nongDoId" class="form-select form-select-sm">
                                                <option value="">Tất cả</option>
                                                <option th:each="nd : ${listNongDo}"
                                                        th:value="${nd.id}"
                                                        th:text="${nd.tenNongDo}"
                                                        th:selected="${nongDoId != null and nongDoId == nd.id}">
                                                </option>
                                            </select>
                                        </th>

                                        <th></th>
                                        <th></th>

                                        <th>
                                            <button type="submit" class="btn btn-sm btn-primary">
                                                <i class="bi bi-funnel"></i>
                                            </button>
                                            <a th:href="@{/admin/san-pham-chi-tiet}" class="btn btn-sm btn-outline-secondary">
                                                <i class="bi bi-x-lg"></i>
                                            </a>
                                        </th>
                                    </tr>
                                    </thead>

                                    <tbody>

                                    <tr th:each="spct, iter : ${page.data}">
                                        <td th:text="${(page.currentPage - 1) * page.size + iter.index + 1}"></td>

                                        <td>
                                            <img th:if="${spct.hinhAnh}"
                                                 th:src="@{'/images/uploads/' + ${spct.hinhAnh}}"
                                                 style="max-width:50px">
                                            <span th:unless="${spct.hinhAnh}">---</span>
                                        </td>

                                        <td th:text="${spct.tenSanPham}"></td>
                                        <td th:text="${spct.maSKU}"></td>
                                        <td th:text="${#numbers.formatInteger(spct.giaBan,0,'POINT')} + ' đ'"></td>
                                        <td th:text="${spct.soMl} + ' ml'"></td>
                                        <td th:text="${spct.tenNongDo} ?: '---'"></td>
                                        <td th:text="${spct.soLuongTon}"></td>

                                        <td>
                                            <span th:if="${spct.trangThai}" class="badge bg-success">Đang bán</span>
                                            <span th:unless="${spct.trangThai}" class="badge bg-secondary">Ngừng bán</span>
                                        </td>

                                        <td>
                                            <a th:href="@{/admin/san-pham-chi-tiet/view/{id}(id=${spct.id})}"
                                               class="btn btn-info btn-sm">
                                                <i class="bi bi-eye"></i>
                                            </a>

                                            <a th:href="@{/admin/san-pham-chi-tiet/edit/{id}(id=${spct.id})}"
                                               class="btn btn-warning btn-sm">
                                                <i class="bi bi-pencil"></i>
                                            </a>

                                            <a th:href="@{/admin/san-pham-chi-tiet/delete/{id}(id=${spct.id})}"
                                               onclick="return confirm('Bạn chắc muốn xóa?')"
                                               class="btn btn-danger btn-sm">
                                                <i class="bi bi-trash"></i>
                                            </a>
                                        </td>
                                    </tr>

                                    <tr th:if="${#lists.isEmpty(page.data)}">
                                        <td colspan="10" class="text-center">Không có sản phẩm.</td>
                                    </tr>

                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>

                    <!-- PHÂN TRANG -->
                    <div class="card-footer" th:if="${page.totalPage > 1}">
                        <nav>
                            <ul class="pagination justify-content-center">

                                <!-- Previous -->
                                <li class="page-item"
                                    th:classappend="${page.currentPage <= 1} ? 'disabled'">
                                    <a class="page-link"
                                       th:href="@{/admin/san-pham-chi-tiet(
                                            page=${page.currentPage - 1},
                                            keyword=${keyword},
                                            sku=${sku},
                                            giaMin=${giaMin},
                                            giaMax=${giaMax},
                                            dungTichId=${dungTichId},
                                            nongDoId=${nongDoId}
                                       )}">
                                        Previous
                                    </a>
                                </li>

                                <!-- Các trang -->
                                <li class="page-item"
                                    th:each="i : ${#numbers.sequence(1, page.totalPage)}"
                                    th:classappend="${page.currentPage == i} ? 'active'">
                                    <a class="page-link"
                                       th:href="@{/admin/san-pham-chi-tiet(
                                            page=${i},
                                            keyword=${keyword},
                                            sku=${sku},
                                            giaMin=${giaMin},
                                            giaMax=${giaMax},
                                            dungTichId=${dungTichId},
                                            nongDoId=${nongDoId}
                                       )}"
                                       th:text="${i}">
                                    </a>
                                </li>

                                <!-- Next -->
                                <li class="page-item"
                                    th:classappend="${page.currentPage >= page.totalPage} ? 'disabled'">
                                    <a class="page-link"
                                       th:href="@{/admin/san-pham-chi-tiet(
                                            page=${page.currentPage + 1},
                                            keyword=${keyword},
                                            sku=${sku},
                                            giaMin=${giaMin},
                                            giaMax=${giaMax},
                                            dungTichId=${dungTichId},
                                            nongDoId=${nongDoId}
                                       )}">
                                        Next
                                    </a>
                                </li>

                            </ul>
                        </nav>
                    </div>

                </div>
            </section>
        </div>

        <footer th:replace="~{/admin/fragments/footer :: footer}"></footer>
    </div>
</div>

<div th:replace="~{/admin/fragments/script :: script}"></div>
</body>

</html>
