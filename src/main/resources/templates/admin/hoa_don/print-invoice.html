<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:href="@{/admin/assets/compiled/jpg/logo3.png}">
    <meta charset="UTF-8">
    <title th:text="${isTamTinh} ? 'Phiếu tạm tính #' + ${donHang.ma} : 'Hóa đơn #' + ${donHang.ma}">
        Hóa đơn
    </title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
          rel="stylesheet"/>

    <style>
        body {
            background:#f3f4f6;
            font-size:13px;
        }
        .invoice-wrapper {
            max-width:800px;
            margin:20px auto;
            background:#fff;
            border-radius:12px;
            padding:24px 28px;
            box-shadow:0 10px 30px rgba(15,23,42,.12);
        }
        .brand-name {
            font-weight:700;
            font-size:20px;
            letter-spacing: .08em;
            text-transform:uppercase;
        }
        .section-title {
            font-size:13px;
            font-weight:600;
            letter-spacing:.08em;
            text-transform:uppercase;
            color:#6b7280;
        }
        .table-sm th, .table-sm td { padding-top: .4rem; padding-bottom: .4rem; }
        .totals-row span:first-child { color:#6b7280; }
        .totals-grand {
            border-top:1px dashed #e5e7eb;
            margin-top:8px;
            padding-top:8px;
            font-size:16px;
            font-weight:700;
            color:#dc2626;
        }
        @media print {
            body { background:#fff; }
            .invoice-wrapper { box-shadow:none; margin:0; border-radius:0; }
            .btn-print { display:none; }
        }
    </style>
</head>
<body>

<div class="invoice-wrapper">
    <!-- Header + nút in -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <div class="brand-name">FPERFUME</div>
            <div class="text-muted small"
                 th:text="${isTamTinh} ? 'Phiếu tạm tính' : 'Hóa đơn mua hàng'">
                Hóa đơn mua hàng
            </div>
        </div>
        <button type="button" class="btn btn-outline-secondary btn-sm btn-print"
                onclick="window.print()">
            <i class="bi bi-printer"></i> In
        </button>
    </div>

    <!-- Mã đơn + ngày -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <div class="section-title mb-1">MÃ ĐƠN HÀNG</div>
            <div class="fw-semibold" th:text="${donHang.ma}">HD-XXXX</div>

            <!-- Kênh bán -->
            <div class="mt-1">
            <span class="badge bg-primary"
                  th:if="${donHang.kenhBan == 'WEB'}">
                Đơn hàng ONLINE
            </span>
                <span class="badge bg-success"
                      th:if="${donHang.kenhBan == 'TAI_QUAY'}">
                Đơn hàng TẠI QUẦY
            </span>
            </div>
        </div>
        <div class="text-end">
            <div class="section-title mb-1">NGÀY MUA HÀNG</div>
            <div th:text="${#temporals.format(donHang.ngayTao, 'dd/MM/yyyy HH:mm')}">
                01/01/2025 10:00
            </div>
        </div>
    </div>


    <!-- Thông tin khách/nhận hàng -->
    <div class="row mb-3">
        <div class="col-md-6 mb-2">
            <div class="section-title mb-1">KHÁCH HÀNG</div>

            <!-- Tên hiển thị: ưu tiên khách có tài khoản,
                 nếu không có thì hiển thị theo kênh bán -->
            <div class="fw-semibold"
                 th:text="${donHang.khachHang != null
                        ? donHang.khachHang.hoTen
                        : (donHang.kenhBan == 'TAI_QUAY'
                            ? 'Khách mua tại quầy'
                            : 'Khách mua online (không đăng nhập)')}">
                Khách lẻ
            </div>

            <!-- Mô tả loại khách -->
            <div class="small text-muted" th:if="${donHang.khachHang != null}">
                Khách có tài khoản trên hệ thống
            </div>
            <div class="small text-muted" th:if="${donHang.khachHang == null}">
            <span th:if="${donHang.kenhBan == 'TAI_QUAY'}">
                Khách không đăng nhập – mua trực tiếp tại quầy
            </span>
                <span th:if="${donHang.kenhBan == 'WEB'}">
                Khách không đăng nhập – đặt hàng online
            </span>
            </div>
        </div>

        <div class="col-md-6 mb-2">
            <div class="section-title mb-1">THÔNG TIN NHẬN HÀNG</div>
            <div class="small">
                <div>
                    <strong th:text="${donHang.tenNguoiNhan}">Nguyễn Văn A</strong>
                </div>
                <div>SĐT: <span th:text="${donHang.sdt}">0123456789</span></div>
                <div th:text="${donHang.diaChi}">Địa chỉ giao hàng...</div>
            </div>
        </div>
    </div>


    <!-- Bảng sản phẩm -->
    <div class="section-title mb-1">CHI TIẾT SẢN PHẨM</div>
    <table class="table table-sm align-middle">
        <thead class="table-light">
        <tr>
            <th>STT</th>
            <th>Sản phẩm</th>
            <th class="text-center">SL</th>
            <th class="text-end">Đơn giá</th>
            <th class="text-end">Thành tiền</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="ct, iter : ${chiTietList}">
            <td th:text="${iter.index + 1}">1</td>
            <td>
                <div class="fw-semibold"
                     th:text="${ct.sanPhamChiTiet.sanPham.tenNuocHoa}">Tên sản phẩm</div>
                <div class="small text-muted">
                    <span th:text="${ct.sanPhamChiTiet.dungTich != null ?
                                     ct.sanPhamChiTiet.dungTich.soMl + ' ml' : ''}">
                    </span>
                    <span th:text="' | SKU: ' + ${ct.sanPhamChiTiet.maSKU}"> | SKU</span>
                </div>
            </td>
            <td class="text-center" th:text="${ct.soLuong}">1</td>
            <td class="text-end"
                th:text="${#numbers.formatDecimal(ct.donGia, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                0 đ
            </td>
            <td class="text-end"
                th:text="${#numbers.formatDecimal(ct.donGia * ct.soLuong, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                0 đ
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Tổng tiền -->
    <div class="mt-2">
        <div class="totals-row d-flex justify-content-between">
            <span>Tổng tiền hàng</span>
            <span th:text="${#numbers.formatDecimal(donHang.tongTienHang, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                0 đ
            </span>
        </div>
        <div class="totals-row d-flex justify-content-between">
            <span>Giảm giá</span>
            <span th:text="'- ' + ${#numbers.formatDecimal(donHang.tienGiamGia, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                - 0 đ
            </span>
        </div>
        <div class="totals-row d-flex justify-content-between">
            <span>Phí ship</span>
            <span th:text="${#numbers.formatDecimal(donHang.phiShip, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                0 đ
            </span>
        </div>
        <div class="totals-grand d-flex justify-content-between">
            <span>Thành tiền</span>
            <span th:text="${#numbers.formatDecimal(donHang.tongThanhToan, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                0 đ
            </span>
        </div>
    </div>
</div>

<!-- Auto print nếu được truyền autoPrint=true -->
<script th:inline="javascript">
    /*<![CDATA[*/
    var autoPrint = [[${autoPrint} ?: false]];
    window.addEventListener('load', function () {
        if (autoPrint) {
            window.print();
        }
    });
    /*]]>*/
</script>

</body>
</html>
