<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{client/fragments/head :: head}"></head>
<body>
<div th:replace="~{client/fragments/header :: header}"></div>

<style>
    .success-icon-box {
        width: 80px;
        height: 80px;
        background-color: #d1e7dd;
        color: #198754;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
    }
    .card-success {
        border: none;
        border-radius: 16px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    .receipt-header {
        background-color: #fff;
        position: relative;
        z-index: 1;
        padding-bottom: 20px;
    }
    .receipt-body {
        background-color: #f8f9fa;
        border-top: 2px dashed #e0e0e0;
        position: relative;
    }
    /* Hiệu ứng răng cưa biên lai */
    .receipt-body::before {
        content: "";
        position: absolute;
        top: -10px;
        left: 0;
        width: 100%;
        height: 10px;
        background: radial-gradient(circle, transparent, transparent 50%, #f8f9fa 50%, #f8f9fa 100%) -7px -8px / 16px 16px repeat-x;
        transform: rotate(180deg);
    }
    /* Table trong biên lai */
    .receipt-table th {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #888;
        font-weight: 600;
        border-bottom: 1px solid #dee2e6;
        padding-bottom: 10px;
    }
    .receipt-table td {
        padding: 12px 0;
        vertical-align: middle;
        font-size: 0.95rem;
        border-bottom: 1px solid #f1f1f1;
    }
    .receipt-table tr:last-child td {
        border-bottom: none;
    }
    /* Alert chuyên nghiệp */
    .email-alert {
        background-color: #fff;
        border-left: 4px solid var(--color-primary);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    }
</style>

<div class="container my-5 py-4">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card card-success">
                <div class="card-body receipt-header text-center p-5">
                    <div class="success-icon-box mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="45" height="45" fill="currentColor" class="bi bi-check-lg" viewBox="0 0 16 16">
                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                        </svg>
                    </div>
                    <h3 class="fw-bold text-success mb-2">Đặt hàng thành công!</h3>
                    <p class="text-muted mb-3">Cảm ơn bạn đã mua sắm tại FPerfume.</p>

                    <div>
                        <!-- ✅ VNPay (IdThanhToan = 3) => luôn hiển thị ĐÃ THANH TOÁN -->
                        <span class="badge bg-success-subtle text-success border border-success-subtle px-3 py-2 rounded-pill"
                              th:if="${(hoaDon.thanhToan.getId() == 3)
                and (hoaDon.trangThai == 'CHỜ XÁC NHẬN' or hoaDon.trangThai == 'CHO_XAC_NHAN')}">
        <i class="bi bi-check-circle-fill me-1"></i> Đã thanh toán thành công
    </span>



                        <span class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle px-3 py-2 rounded-pill"
                              th:if="${(hoaDon.thanhToan.getId() == 1)
                and (hoaDon.trangThai == 'CHỜ XÁC NHẬN' or hoaDon.trangThai == 'CHO_XAC_NHAN')}">
         <i class="bi bi-box-seam-fill me-1"></i> Thanh toán khi nhận hàng (COD)
    </span>
                    </div>

                </div>

                <div class="card-body receipt-body p-4 px-md-5" th:if="${hoaDon != null}">

                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted small">Mã đơn hàng:</span>
                        <span class="fw-bold text-dark" th:text="${hoaDon.ma}">HD-XXXX</span>
                    </div>
                    <div class="d-flex justify-content-between mb-4">
                        <span class="text-muted small">Ngày đặt:</span>
                        <span class="text-dark" th:text="${#temporals.format(hoaDon.ngayTao, 'dd/MM/yyyy HH:mm')}"></span>
                    </div>

                    <div class="table-responsive mb-4">
                        <table class="table receipt-table table-borderless w-100 m-0">
                            <thead>
                            <tr>
                                <th style="width: 55%">Sản phẩm</th>
                                <th class="text-center" style="width: 15%">SL</th>
                                <th class="text-end" style="width: 30%">Thành tiền</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="item : ${hoaDon.hoaDonChiTiets}">
                                <td>
                                    <div class="fw-semibold text-dark"
                                         th:text="${item.sanPhamChiTiet.sanPham.tenNuocHoa}">Tên SP</div>
                                    <div class="small text-muted"
                                         th:text="${item.sanPhamChiTiet.dungTich.soMl + 'ml'}">50ml</div>
                                </td>
                                <td class="text-center fw-bold text-secondary" th:text="${item.soLuong}">1</td>
                                <td class="text-end fw-semibold"
                                    th:text="${#numbers.formatDecimal(item.donGia * item.soLuong, 0, 'POINT', 0, 'NONE')} + ' ₫'">
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="border-top border-bottom py-3 mb-4">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Tổng tiền hàng:</span>
                            <span th:text="${#numbers.formatDecimal(hoaDon.tongTienHang, 0, 'POINT', 0, 'NONE')} + ' ₫'"></span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Phí vận chuyển:</span>
                            <span th:text="${#numbers.formatDecimal(hoaDon.phiShip, 0, 'POINT', 0, 'NONE')} + ' ₫'"></span>
                        </div>
                        <div class="d-flex justify-content-between mb-1 text-success" th:if="${hoaDon.tienGiamGia > 0}">
                            <span><i class="bi bi-ticket-perforated me-1"></i>Voucher giảm giá:</span>
                            <span th:text="'- ' + ${#numbers.formatDecimal(hoaDon.tienGiamGia, 0, 'POINT', 0, 'NONE')} + ' ₫'"></span>
                        </div>

                        <div class="d-flex justify-content-between mt-3 pt-2 border-top">
                            <span class="fw-bold fs-5 text-dark">Tổng thanh toán:</span>
                            <span class="fw-bold fs-4 text-primary"
                                  style="color: var(--color-primary) !important;"
                                  th:text="${#numbers.formatDecimal(hoaDon.tongThanhToan, 0, 'POINT', 0, 'NONE')} + ' ₫'"></span>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h6 class="fw-bold mb-3"><i class="bi bi-geo-alt-fill me-2 text-danger"></i>Thông tin giao hàng</h6>
                        <div class="ps-4 border-start border-3">
                            <p class="mb-1 fw-bold text-dark" th:text="${hoaDon.tenNguoiNhan}">Tên Khách</p>
                            <p class="mb-1 text-muted small"><i class="bi bi-telephone me-1"></i> <span th:text="${hoaDon.sdt}"></span></p>
                            <p class="mb-1 text-muted small" th:text="${hoaDon.diaChi}">Địa chỉ...</p>

                            <div th:if="${hoaDon.ghiChu != null and hoaDon.ghiChu != ''}" class="mt-2 pt-2 border-top">
                                <span class="badge bg-secondary-subtle text-secondary mb-1">Ghi chú:</span>
                                <p class="mb-0 small fst-italic text-dark" th:text="${hoaDon.ghiChu}"></p>
                            </div>
                        </div>
                    </div>

                    <div class="email-alert p-3 d-flex align-items-start">
                        <div class="me-3 mt-1">
                            <i class="bi bi-envelope-paper-heart-fill fs-3 text-primary"></i>
                        </div>
                        <div>
                            <h6 class="fw-bold mb-1 text-dark">Xác nhận đã được gửi!</h6>
                            <p class="mb-0 small text-muted" style="line-height: 1.4;">
                                Thông tin chi tiết đơn hàng đã được gửi đến email của bạn.
                                Vui lòng kiểm tra hộp thư (bao gồm cả mục Spam/Quảng cáo).
                            </p>
                        </div>
                    </div>

                </div>

                <div class="card-footer bg-white p-4 text-center border-0 rounded-bottom">
                    <div class="d-grid gap-2 col-md-8 mx-auto">
                        <a th:href="@{/}" class="btn btn-dark py-2 rounded-pill shadow-sm fw-bold">
                            <i class="bi bi-arrow-left me-2"></i> Tiếp tục mua sắm
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{client/fragments/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>