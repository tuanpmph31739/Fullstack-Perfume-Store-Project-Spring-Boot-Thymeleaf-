<!-- client/fragments/sidebar.html -->
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<body>
<!-- Tham số: brands, selectedBrands, selectedGender, minPrice, maxPrice, selfPath -->
<div class="col-md-3"
     th:fragment="productFilters(brands, selectedBrands, selectedGender, minPrice, maxPrice, selfPath)">
    <div class="filter-box">
        <h5>Lọc sản phẩm</h5>

        <form th:action="${selfPath}" method="get">
            <!-- giữ lại các query đã chọn ngoài form -->
            <input type="hidden" name="page" value="1"/>

            <!-- Brand -->
            <div class="filter-category">
                <h6>Thương hiệu</h6>
                <ul class="list-unstyled mb-2">
                    <li th:each="brand : ${brands}">
                        <label class="d-flex align-items-center gap-2">
                            <input type="checkbox"
                                   name="brand"
                                   th:value="${brand.id}"
                                   th:checked="${selectedBrands != null} ? ${selectedBrands.contains(brand.id)} : false">
                            <span th:text="${brand.tenThuongHieu}">Brand</span>
                        </label>
                    </li>
                </ul>
            </div>

            <!-- Gender -->
            <div class="filter-gender">
                <h6>Giới tính</h6>
                <label class="d-block">
                    <input type="radio" name="gender" value=""
                           th:checked="${selectedGender} == null or ${selectedGender} == ''"> Tất cả
                </label>
                <label class="d-block">
                    <input type="radio" name="gender" value="nam"
                           th:checked="${selectedGender} == 'nam'"> Nam
                </label>
                <label class="d-block">
                    <input type="radio" name="gender" value="nu"
                           th:checked="${selectedGender} == 'nu'"> Nữ
                </label>
                <label class="d-block">
                    <input type="radio" name="gender" value="unisex"
                           th:checked="${selectedGender} == 'unisex'"> Unisex
                </label>
            </div>

            <!-- Price -->
            <div class="filter-price mt-3" th:with="minVal=${minPrice}?:0">
                <h6>Khoảng giá</h6>

                <input type="range"
                       min="0" max="50000000" step="500000"
                       th:value="${minVal}"
                       id="priceRange"
                       oninput="updatePriceRange()">

                <div class="small mt-1">
                    <span id="priceRangeValue"
                          th:text="${#numbers.formatDecimal(minVal, 0, 'POINT', 0, 'NONE')}">0</span> ₫
                </div>

                <!-- Hidden thực tế gửi đi -->
                <input type="hidden" name="min" th:value="${minVal}">
                <input type="hidden" name="max" th:value="${maxPrice != null ? maxPrice : 0}">
            </div>

            <div class="mt-3 d-flex gap-2">
                <button type="submit" class="btn btn-primary btn-sm">Áp dụng</button>
                <a class="btn btn-outline-secondary btn-sm" th:href="${selfPath}">Xóa lọc</a>
            </div>
        </form>
    </div>

    <script>
        function updatePriceRange() {
            const range = document.getElementById('priceRange');
            const hiddenMin = document.querySelector('input[name="min"]');
            const display = document.getElementById('priceRangeValue');

            if (!range || !display) return;

            const value = parseInt(range.value, 10) || 0;
            if (hiddenMin) hiddenMin.value = value;
            // hiển thị có dấu . theo vi-VN
            display.textContent = value.toLocaleString('vi-VN');
        }

        document.addEventListener('DOMContentLoaded', updatePriceRange);
    </script>
</div>
</body>
</html>
